<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8" />
        <link rel="shortcut icon" href="/favicon.ico" />
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="theme-color" content="#000000">

        <link rel="stylesheet" href="/styles/main.css">
        <script src="vue.global.prod.js"></script>
        <title>LSF测试</title>
    </head>

    <body>
        <noscript>
            You need to enable JavaScript to run this app.
        </noscript>


        <div id="ls-container" class="ls-container">
            <div style="width: 180px;margin-top: 48px;">
                <img @click="onImageClick(item)" v-for="(item, index) in tasks" :key="index" :src="item.url"
                    class="left-pannel-img" />
            </div>

            <div id="label-studio" class="label-studio"></div>

        </div>

        <style>
            body {
                height: 100vh;
            }

            .ls-container {
                display: flex;
            }

            .label-studio {
                height: calc(100vh - 88px);
                width: calc(100% - 180px) !important;
            }

            .left-pannel-img {
                height: 140px;
                width: 140px;
                margin: 20px;
            }
        </style>
        <script>
            const { createApp } = Vue;
            var options = {
                interfaces: [
                    "panel",
                    "update",
                    "submit",
                    // "skip",
                    "controls",
                    // "review",
                    // "infobar",
                    "topbar",
                    // "instruction",
                    // "side-column",
                    // "ground-truth",
                    "annotations:tabs",
                    "annotations:menu",
                    "annotations:history",
                    "annotations:current",
                    // "annotations:add-new",
                    // "annotations:delete",
                    // 'annotations:view-all',
                    // "predictions:tabs",
                    // "predictions:menu",
                    // "auto-annotation",
                    // "edit-history",
                    // "topbar:prevnext",
                ],
                config: `
                    <View>
                        <Ellipse name="ellipse1-1" toName="image" />
                        <Image name="image" value="$image" />
                        <Rectangle name="rect-1" toName="image" />
                        <Polygon name="rect-2" toName="image" />
                        <labels id = "123" name="lbl" toName="image">
                          <label name="肺结节标签" value="肺结节标签" background="blue"></label>
                          <label name="肺结节标签2" value="肺结节标签2" background="red"></label>
                      </labels>
                    </View>`,
                task: {
                    annotations: [
                        {
                            id: '1001',
                            createdBy: '邓宏',
                            createdDate: '2023-05-08',
                            result: [
                                {
                                    id: 'Dx_aB91ISN',
                                    source: '$image',
                                    from_name: 'rect-1',
                                    to_name: 'image',
                                    type: 'rectangle',
                                    origin: 'manual',
                                    // hidden: true,
                                    locked: true,
                                    value: {
                                        height: 10.458911419423693,
                                        width: 12.4,
                                        x: 5,
                                        y: 5,
                                    },
                                },
                                {
                                    id: 'Dx_aB91ISN',
                                    source: '$image',
                                    from_name: 'lbl',
                                    to_name: 'image',
                                    type: 'labels',
                                    origin: 'manual',
                                    value: {
                                        height: 10.458911419423693,
                                        width: 12.4,
                                        x: 5,
                                        y: 5,
                                        labels: [
                                            "肺结节标签"
                                        ],
                                    },
                                },
                                {
                                    id: 'Dx_aB91ISN1',
                                    source: '$image',
                                    from_name: 'rect-1',
                                    to_name: 'image',
                                    type: 'rectangle',
                                    origin: 'manual',
                                    value: {
                                        height: 10.458911419423693,
                                        width: 12.4,
                                        x: 20,
                                        y: 20,
                                    },
                                },
                                {
                                    id: 'Dx_aB91ISN1',
                                    source: '$image',
                                    from_name: 'lbl',
                                    to_name: 'image',
                                    type: 'labels',
                                    origin: 'manual',
                                    value: {
                                        height: 10.458911419423693,
                                        width: 12.4,
                                        x: 20,
                                        y: 20,
                                        labels: [
                                            "肺结节标签2"
                                        ],
                                    },
                                }

                            ],
                        }
                    ],
                    id: 1,
                    data: {
                        image: "https://htx-misc.s3.amazonaws.com/opensource/label-studio/examples/images/nick-owuor-astro-nic-visuals-wDifg5xc9Z4-unsplash.jpg"
                    }
                },
            }


            const app = createApp({
                data() {
                    return {
                        ls: "",
                        tasks: [
                            {
                                url: "https://htx-misc.s3.amazonaws.com/opensource/label-studio/examples/images/nick-owuor-astro-nic-visuals-wDifg5xc9Z4-unsplash.jpg",
                                result: [
                                    {
                                        id: 'Dx_aB91ISN',
                                        source: '$image',
                                        from_name: 'lbl',
                                        to_name: 'image',
                                        type: 'labels',
                                        origin: 'manual',
                                        value: {
                                            height: 10.458911419423693,
                                            width: 12.4,
                                            x: 80,
                                            y: 80,
                                            labels: [
                                                "肺结节标签2"
                                            ],
                                        },
                                    },
                                ]
                            },
                            {
                                url: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQp26Bu2Le6S4w_0-yPtTPEMbGpxlUs8ATcJQ&usqp=CAU",
                                result: [
                                    {
                                        id: 'Dx_aB91ISN',
                                        source: '$image',
                                        from_name: 'rect-1',
                                        to_name: 'image',
                                        type: 'rectangle',
                                        origin: 'manual',
                                        // hidden: true,
                                        locked: true,
                                        value: {
                                            height: 10.458911419423693,
                                            width: 12.4,
                                            x: 5,
                                            y: 5,
                                        },
                                    },
                                    {
                                        id: 'Dx_aB91ISN',
                                        source: '$image',
                                        from_name: 'lbl',
                                        to_name: 'image',
                                        type: 'labels',
                                        origin: 'manual',
                                        value: {
                                            height: 10.458911419423693,
                                            width: 12.4,
                                            x: 5,
                                            y: 5,
                                            labels: [
                                                "肺结节标签"
                                            ],
                                        },
                                    },
                                ]
                            }
                        ]
                    }
                },
                methods: {
                    onImageClick(item) {
                        console.log(this.ls);
                        options.task.annotations[0].result = item.result;
                        options.task.data.image = item.url;
                        this.ls.destroy();
                        this.initData();
                    },
                    initData() {
                        this.ls = new LabelStudio("label-studio", options);
                        this.ls.on("storageInitialized", (store) => {
                            console.log(store);
                            // ls.on("selectAnnotation", (next) => {
                            //     console.log(next);
                            // })

                            // ls.on("regionFinishedDrawing", (region, list) => {
                            //     console.log("finish drawing", region)
                            // })

                        })

                        this.ls.on("updateAnnotation", (LS, annotation) => {
                            // Retrieve an annotation in JSON format

                            // annotation表示当前页面的所有数据

                            //获取所有的标签数据
                            // let annotations = LS.annotationStore.annotations;

                            // annotations.forEach(annotation => {
                            //     console.log(annotation.serializeAnnotation())
                            // });

                            console.log(annotation.serializeAnnotation())
                        });
                    }
                },
                mounted() {
                    document.addEventListener('DOMContentLoaded', (e) => {
                        this.initData();
                    })
                },
            });
            app.mount("#ls-container");
        </script>
    </body>

</html>